<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>全栈开发TODO实例文档 | dmemoing</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">全栈开发TODO实例文档</h1><a id="logo" href="/.">dmemoing</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">全栈开发TODO实例文档</h1><div class="post-meta">Apr 1, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p><img src="/images/todo/todo.png" alt="TODO总览"><br>这是我们要开发的TODO实例的架构总览，下面我们就来一步步实现这个实例。</p>
<h2 id="ionic"><a href="#ionic" class="headerlink" title="ionic"></a>ionic</h2><p>ionic的安装需要nodejs的环境，<a href="https://nodejs.org/en/" target="_blank" rel="external">官网</a>上有各个版本系统的安装包，下载安装即可。安装完成后，npm工具就应该可以使用了，通过命令<code>npm -v</code>查看是否成功安装。</p>
<p>ionic官网上可以找到<a href="http://ionicframework.com/docs/v1/getting-started/" target="_blank" rel="external">getting-started</a>文档，我们使用<code>ionic v1</code>版本，介绍了安装，创建初始项目，运行，添加platform，打包，模拟器模拟的命令。</p>
<h4 id="创建空项目"><a href="#创建空项目" class="headerlink" title="创建空项目"></a>创建空项目</h4><p>安装完成环境后，我们开始我们前端项目的构建。<br>命令行输入<code>ionic start todo blank</code>，生成空项目，项目结构如下。<br><img src="/images/todo/ionic.png" alt="项目架构"></p>
<p>创建完成后，进入该文件夹，通过命令<code>ionic serve</code>，启动创建好的空项目，会自动打开浏览器，显示自动生成的空项目的内容，推荐使用chrome最为默认浏览器，按<code>F12</code>进入开发者模式，左上角点击<img src="/images/todo/button.png" alt="">图标，切换到响应式开发模式，这是网页被切换到手机屏幕大小，方便我们开发移动应用。运行效果如下图。<br><img src="/images/todo/blank.png" alt="空视图"></p>
<h4 id="添加list"><a href="#添加list" class="headerlink" title="添加list"></a>添加list</h4><p>我们需要通过编写一个Web前端来实现app的开发，所以我们需要修改的内容主要是在<code>www</code>文件夹中。<br>在<code>www</code>文件夹中，我们主要修改的是<code>index.html</code>和<code>js/app.js</code>文件。</p>
<p>首先我们需要在<code>index.html</code>添加一个list以显示tasks，所以在html文件<code>&lt;ion-content&gt;</code>标签范围内添加如下代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ion-list</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">ion-item</span> <span class="attr">ng-repeat</span>=<span class="string">"task in tasks"</span>&gt;</span></div><div class="line">    &#123;&#123;task.title&#125;&#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">ion-item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ion-list</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>标签<code>ion-header-bar</code>显示标题，<code>ion-content</code>则显示页面的相应内容，所以我们的list添加在<code>&lt;ion-content&gt;</code>标签范围内。</p>
<p>如上代码中，我们还做了数据的绑定，即将控制器中<code>tasks</code>数组里的每条数据，都绑定到一个<code>ion-item</code>标签中，作为list的一条内容，在angular中通过双大括号实现数据绑定，还有另外一种使用<code>ng-model</code>实现绑定的格式，我们会在下面的内容中介绍。</p>
<p>我们还没有定义所需的控制器，在<code>js/app.js</code>文件中，我们来定义我们对视图的控制器，将一下代码添加都文件的最后<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">.controller(<span class="string">'TodoCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>) </span>&#123;</div><div class="line">  $scope.tasks = [</div><div class="line">    &#123; <span class="attr">title</span>: <span class="string">'Collect coins'</span> &#125;,</div><div class="line">    &#123; <span class="attr">title</span>: <span class="string">'Eat mushrooms'</span> &#125;,</div><div class="line">    &#123; <span class="attr">title</span>: <span class="string">'Get high enough to grab the flag'</span> &#125;,</div><div class="line">    &#123; <span class="attr">title</span>: <span class="string">'Find the Princess'</span> &#125;</div><div class="line">  ];</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>我们还需要在html中申明我们的控制器，即该控制器控制哪一部分的视图，在html代码中添加。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"starter"</span> <span class="attr">ng-controller</span>=<span class="string">"TodoCtrl"</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>此时我们就完成了基本list的构建，同时将控制器中tasks数组绑定到了视图中。这里需要解释一下<code>$scope</code>的概念，每个控制器都对应着一个域，每个控制器控制着html模板中的一部分视图，在该部分视图中使用的变量或者函数都需要定义在这个域中，反过来说，只要你要<code>$scope</code>中定义了的变量和函数，你都可以在相应视图中直接使用。</p>
<p>此时我们看到的运行效果应该如下：<br><img src="/images/todo/list.png" alt="list"></p>
<h4 id="添加输入框和按钮"><a href="#添加输入框和按钮" class="headerlink" title="添加输入框和按钮"></a>添加输入框和按钮</h4><p>接下来我们要添加输入框和创建按钮，以实现添加新task的功能。</p>
<p>在<code>index.html</code>代码中添加如下表单，添加在<code>&lt;ion-list&gt;</code>的上面<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"item item-input"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"What do you need to do?"</span> &gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"button button-small button-positive"</span>&gt;</span>Create Task<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>这里主要就两个组件，一个<code>input</code>输入框，还有一个<code>button</code>按钮，此时显示效果如下：<br><img src="/images/todo/input.png" alt="输入框"><br>但我们输入后点击，没有任何效果，这是因为html中只定义视图，具体的控制逻辑需要使用javascript代码来定义，即在控制器中编写。</p>
<h4 id="添加控制逻辑"><a href="#添加控制逻辑" class="headerlink" title="添加控制逻辑"></a>添加控制逻辑</h4><p>在添加控制逻辑之前，我们先要对上述<code>form</code>表单进行一些简单修改<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-submit</span>=<span class="string">"createTask(task)"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"item item-input"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"What do you need to do?"</span> <span class="attr">ng-model</span>=<span class="string">"task.title"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"button button-small button-positive"</span>&gt;</span>Create Task<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>添加<code>ng-submit</code>属性，将<code>createTask()</code>函数复制给该属性，表明该表单的提交交给该函数来处理，我们又一个输入的值，如何获取这个值并且传给函数，这里用到<code>ng-model</code>将输入框的值绑定到<code>task</code>变量的<code>title</code>键上，之后再将task变量传给函数作为参数。</p>
<p>后台控制其中对于<code>createTask()</code>函数的实现如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Called when the form is submitted</span></div><div class="line">$scope.createTask = <span class="function"><span class="keyword">function</span>(<span class="params">task</span>) </span>&#123;</div><div class="line">  $scope.tasks.push(&#123;</div><div class="line">    <span class="attr">title</span>: task.title</div><div class="line">  &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>其操作是将新建的task添加到tasks数组中，因为我们进行了数据绑定，所以新的数据会自动更新到视图中，不需要我们额外编写任何代码，这也是angular框架很方便的一个地方。</p>
<p>以上一个基本的todo应用就完成了，但此时应用的数据都是没有存储的，只要我们一刷刷新，之前添加的task就全都没有了，这不是我们所预期的，我们希望应用新打开的时候，之前存入的数据还在，因此我们需要引入服务器及数据库的概念。</p>
<h4 id="打包运行"><a href="#打包运行" class="headerlink" title="打包运行"></a>打包运行</h4><p>在将后端的内容之前，我们介绍ionic应用打包相关的内容。ionic应用打包十分简单，通过如下两条命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ ionic platform add android</div><div class="line">$ ionic build android</div></pre></td></tr></table></figure></p>
<p>以上两条命令就可以完成应用的打包，但这两条命令可以运行的前提是你需要安装<code>android sdk</code>，下载和安装都可以在<code>Android Developer</code>上找到，这里直接给出<a href="https://developer.android.com/studio/index.html?hl=zh-cn" target="_blank" rel="external">下载链接</a>。</p>
<p>打包ios应用也是使用上述类似命令，同样需要ios开发环境才能完成打包。</p>
<h2 id="mongodb数据库"><a href="#mongodb数据库" class="headerlink" title="mongodb数据库"></a>mongodb数据库</h2><p>接下来我们讲解后端的内容。</p>
<p>首先我们介绍数据存储。这里我们使用mongodb数据库来存储我们的数据，<code>mongodb</code>以<code>json</code>格式存储数据，即键值对的形式，如下是一个json格式的对象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	name: &quot;Nancy&quot;,</div><div class="line">	school: &quot;Nanjing University&quot;,</div><div class="line">	ID: &quot;141220016&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在我们上面完成的前端中，我们使用到的数据的格式也是json格式的，所以使用mongodb来存储数据十分方便。</p>
<h4 id="mongodb安装"><a href="#mongodb安装" class="headerlink" title="mongodb安装"></a>mongodb安装</h4><p>mongodb的安装，给出<a href="https://www.mongodb.com/download-center?jmp=nav#community" target="_blank" rel="external">官方下载地址</a>，选择对应的系统下载，下面的<code>Installation Instructions</code>提供详细的安装介绍。</p>
<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p>安装完成后，我们运行数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mongod -dbpath &quot;path to db directory&quot;</div></pre></td></tr></table></figure></p>
<p>后面需要自己规定数据库数据存储的位置，这是启动数据库</p>
<p>启动完成后，我们可以登录进数据库查看<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mongo</div></pre></td></tr></table></figure></p>
<p>命令会自动连接到本地的mongodb数据库，一些简单的数据库操作命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//查看具有的db</div><div class="line">$ show dbs</div><div class="line"></div><div class="line">//使用默认创建的test数据库</div><div class="line">$ use test</div><div class="line"></div><div class="line">//查看数据库具有的collection</div><div class="line">$ show collections</div><div class="line"></div><div class="line">//查看collection tasks中所有的document</div><div class="line">$ db.tasks.find().pretty()</div></pre></td></tr></table></figure></p>
<p>如何用代码来实现对数据库的插入、查找等操作，我们通过<code>mongoose</code>插件来进行。<code>mongoose</code>则需要结合<code>express</code>等框架来使用。</p>
<p>下面介绍服务器端的开发。</p>
<h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><p>我们的服务器使用nodejs编写，为了方便快速开发，我们使用<code>express</code>框架。<br>通过如下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install -g express express-generator</div></pre></td></tr></table></figure></p>
<p>安装express项目生成器，安装完成后通过命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ express -e backend</div></pre></td></tr></table></figure></p>
<p>自动生成一个空的项目，具有完善的架构。<br>空项目创建完成后，进入该项目，运行命令<code>npm install</code>安装项目所需的依赖包。<br>之后项目通过<code>npm start</code>来运行，注意每次对代码修改后，都需要重新运行该命令来查看新添加的功能。</p>
<h4 id="创建数据模型"><a href="#创建数据模型" class="headerlink" title="创建数据模型"></a>创建数据模型</h4><p>上面我们提到要使用<code>mongoose</code>插件，我们通过如下命令安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install --save mongoose</div></pre></td></tr></table></figure></p>
<p>该命令只会讲<code>mongoose</code>插件安装到该项目，即将代码下载到<code>node_modules</code>文件夹中，不会全局安装，全局安装通过添加<code>-g</code>参数来实现，就想上面我们安装<code>express</code>一样。</p>
<p><code>--save</code>参数将我们安装的<code>mongoose</code>信息写进项目插件的配置文件中，即<code>package,json</code>文件，下次只需要使用<code>npm install</code>命令就会将所有需要的插件都安装上，不需要每次单独安装。</p>
<p>我们在项目根目录下新建一个文件夹<code>models</code>用来存储我们的数据模型，在该文件夹中创建文件<code>task.js</code>，其中具体代码如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> TaskSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">  <span class="attr">title</span>: <span class="built_in">String</span>,</div><div class="line">  <span class="attr">create_at</span>: &#123;</div><div class="line">    <span class="attr">type</span>: <span class="built_in">Date</span>,</div><div class="line">    <span class="attr">default</span>: <span class="built_in">Date</span>.now</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">"Task"</span>, TaskSchema);</div></pre></td></tr></table></figure></p>
<p>首先需要申明使用到的插件，即<code>require</code>，将其返回值赋给变量<code>mongoose</code>，以备接下来使用。</p>
<p>使用<code>mongoose.Schema</code>定义出我们存储数据的模板， 包括两个键值对，一个即<code>title</code>，对应一个<code>String</code>类型的数据，还有一个键是<code>create_at</code>，对应着task创建的时间。</p>
<p>我们使用定义好的这个<code>TaskSchema</code>数据模板来定义我们的数据模型<code>Task</code>，因为我们需要在别的文件中使用到这个模型来进行创建、查找，所以我们将该模型<code>exports</code>出来。</p>
<p>光定义好模型还不行，我们需要先跟mongodb数据库建立连接，在<code>app.js</code>文件中添加<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line">mongoose.connect(<span class="string">'mongodb://localhost/test'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (err) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'connection error'</span>, err);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'connection successful'</span>);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>这样数据模型以及数据库连接就完成了。</p>
<h4 id="定义路由"><a href="#定义路由" class="headerlink" title="定义路由"></a>定义路由</h4><p>我们编写后端是为了相应前端发送的请求，接下来我们定义RESTful的接口，以相应前端请求。</p>
<p>在<code>routes</code>文件夹中新建文件<code>task.js</code>，具体代码为<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> router = express.Router();</div><div class="line"><span class="keyword">var</span> Task = <span class="built_in">require</span>(<span class="string">'../models/task'</span>);</div><div class="line"></div><div class="line">router.post(<span class="string">"/"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> task = req.body;</div><div class="line">	Task.create(task, <span class="function"><span class="keyword">function</span>(<span class="params">err, task</span>)</span>&#123;</div><div class="line">		<span class="keyword">if</span> (err) &#123;</div><div class="line">			<span class="keyword">return</span> res.status(<span class="number">400</span>).send(<span class="string">"err in post /task"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">return</span> res.status(<span class="number">200</span>).json(task);</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">router.get(<span class="string">"/"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>)</span>&#123;</div><div class="line">	Task.find(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, tasks</span>)</span>&#123;</div><div class="line">		<span class="keyword">if</span>(err)&#123;</div><div class="line">			<span class="keyword">return</span> res.status(<span class="number">400</span>).send(<span class="string">"err in get /task"</span>);</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			<span class="built_in">console</span>.log(tasks);</div><div class="line">			<span class="keyword">return</span> res.status(<span class="number">200</span>).json(tasks);</div><div class="line">		&#125;</div><div class="line">	&#125;)</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = router;</div></pre></td></tr></table></figure></p>
<p>主要包含两个接口，一个用来接收post请求，对应着创建task，一个用来接收get请求，对应着获取所有tasks，这两个请求接收到后，都通过已经定义好的<code>Task</code>模型，完成对数据库的操作，之后再返回消息给前端。</p>
<p>定义完接口后，我们需要在<code>app.js</code>文件中申明并使用它<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var task = require(&apos;./routes/task&apos;);</div><div class="line">app.use(&apos;/task&apos;, task);</div></pre></td></tr></table></figure></p>
<p>同时，我们需要使用另外一个插件<code>cors</code>，用来处理我们收到请求的头部信息，通过命令<code>npm install --save cors</code>安装，在<code>app.js</code>代码中添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var cors = require(&apos;cors&apos;);</div><div class="line">app.use(cors());</div></pre></td></tr></table></figure></p>
<p>以上我们的服务器代码就完成了，使用命令<code>npm start</code>运行服务器。<br>我们可以使用<a href="https://www.getpostman.com/" target="_blank" rel="external">postman</a>来模拟发送请求到服务器，验证服务器是否正确接收请求并返回正确信息。<br><img src="/images/todo/post.png" alt="post请求"><br><img src="/images/todo/get.png" alt="get请求"><br>以上是模拟发送post和get请求。</p>
<h2 id="前后端连接"><a href="#前后端连接" class="headerlink" title="前后端连接"></a>前后端连接</h2><p>接下来我们要修改前端代码，是应用发送相应请求到服务器，实现数据的存储和读取。</p>
<p>主要修改js部分的代码，我们创建一个<code>Factory</code>，专门用来跟服务器通信。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">.factory(<span class="string">'Tasks'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$http</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> base = <span class="string">"http://localhost:3000"</span>;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">all</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> $http.get(base + <span class="string">"/task"</span>);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">save</span>: <span class="function"><span class="keyword">function</span>(<span class="params">task</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> $http.post(base + <span class="string">"/task"</span>, &#123;<span class="attr">title</span>: task.title&#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>之后我们在控制器中使用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">.controller(<span class="string">'TodoCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope, $ionicModal, Tasks</span>) </span>&#123;</div><div class="line">  Tasks.all()</div><div class="line">    .success(<span class="function"><span class="keyword">function</span>(<span class="params">tasks</span>)</span>&#123;</div><div class="line">      $scope.tasks = tasks;</div><div class="line">      <span class="built_in">console</span>.log($scope.tasks);</div><div class="line">    &#125;)</div><div class="line">    .error(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      $scope.tasks = [];</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">  <span class="comment">// Called when the form is submitted</span></div><div class="line">  $scope.createTask = <span class="function"><span class="keyword">function</span>(<span class="params">task</span>) </span>&#123;</div><div class="line">    $scope.tasks.push(&#123;</div><div class="line">      <span class="attr">title</span>: task.title</div><div class="line">    &#125;);</div><div class="line">    Tasks.save(task)</div><div class="line">      .success(<span class="function"><span class="keyword">function</span>(<span class="params">task</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(task);</div><div class="line">      &#125;)</div><div class="line">      .error(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"request error"</span>);</div><div class="line">      &#125;);</div><div class="line">  &#125;;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>分别是在应用刚开始运行的时候，调用<code>all()</code>函数，后去所有数据库中已经存储了的task，另外就是创建新的task的时候，将新的task存储到数据库。回调函数的内容在这里不再赘述。</p>
<p>这样我们的从前端到后端到数据存储的一个完整的应用就完成了，新建的task都会存储到服务器，每次应用打开都会显示已经创建的所有的tasks。</p>
<p>整个项目的代码都放在<a href="https://github.com/dmemoing/TodoDemo" target="_blank" rel="external">github</a>上。</p>
<p>希望同学们在按照这篇文档实践后，能够掌握全栈开发的技术，完成后续功能的添加。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/04/01/todo-document/" data-id="cj0z0rnni0002q8o0o74c4dmr" class="article-share-link">分享到</a><div class="tags"><a href="/tags/ionic/">ionic</a><a href="/tags/nodejs/">nodejs</a><a href="/tags/express/">express</a><a href="/tags/mongodb/">mongodb</a></div><div class="post-nav"><a href="/2017/04/01/hello-world/" class="next">Hello World</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/react/" style="font-size: 15px;">react</a> <a href="/tags/angular2/" style="font-size: 15px;">angular2</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/ionic/" style="font-size: 15px;">ionic</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/express/" style="font-size: 15px;">express</a> <a href="/tags/mongodb/" style="font-size: 15px;">mongodb</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/01/todo-document/">全栈开发TODO实例文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/01/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/04/react-and-angular2/">react和angular2比较</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">dmemoing.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>